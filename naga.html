<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Naga | Instinct</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --bg: #000000;
        --text: #ffffff;
        --muted: #444;
        --accent: #ff3b3b;
        --title-grad: linear-gradient(90deg, #ffffff 0%, #333333 100%);
      }

      * {
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: var(--bg);
        color: var(--text);
        overflow: hidden;
      }

      /* PHOTO-STYLE BACKGROUND */
      .bg-layer {
        position: fixed;
        inset: 0;
        z-index: -1;
        background:
          radial-gradient(
            circle at center,
            transparent 0%,
            rgba(0, 0, 0, 1) 90%
          ),
          url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiMxYjFiMWIiLz48L3N2Zz4=");
      }

      /* ================= NAVBAR ================= */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 90px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 60px;
        z-index: 100;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.3rem;
        font-weight: 800;
        letter-spacing: -1px;
        cursor: pointer;
        text-decoration: none;
        color: white;
      }

      .nav-links {
        display: flex;
        gap: 30px;
      }
      .nav-links button {
        background: none;
        border: none;
        color: var(--muted);
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 500;
        transition: 0.3s;
      }
      .nav-links button:hover {
        color: #fff;
      }

      .play-now-btn {
        background: transparent;
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 10px 22px;
        border-radius: 10px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: 0.3s;
      }
      .play-now-btn:hover {
        background: #fff;
        color: #000;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      }

      /* ================= SCREENS ================= */
      .screen {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 40px;
        z-index: 50;
        background: rgba(0, 0, 0, 0.8);
      }
      .hidden {
        display: none !important;
      }

      .hero-title {
        font-size: clamp(2.5rem, 6vw, 4.5rem);
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 20px;
        letter-spacing: -2px;
        background: var(--title-grad);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .hero-sub {
        max-width: 500px;
        color: #666;
        font-size: 0.95rem;
        margin-bottom: 40px;
      }

      /* ================= GAME BOARD ================= */
      #game-container {
        position: absolute;
        top: 100px;
        bottom: 80px;
        left: 40px;
        right: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      canvas {
        image-rendering: pixelated;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
      }

      .hud {
        position: fixed;
        bottom: 30px;
        width: 100%;
        text-align: center;
        font-size: 0.7rem;
        color: #444;
        text-transform: uppercase;
        letter-spacing: 4px;
        z-index: 60;
      }

      .pause-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 150;
      }

      .countdown {
        font-size: 6rem;
        font-weight: 900;
        color: #fff;
      }

      .dev-badge {
        position: fixed;
        top: 110px;
        right: 60px;
        background: #fff;
        color: #000;
        padding: 4px 12px;
        font-size: 0.6rem;
        border-radius: 4px;
        font-weight: 800;
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <div class="bg-layer"></div>

    <div class="navbar">
      <a href="#" class="brand" onclick="location.reload()">Naga</a>
      <div class="nav-links">
        <button onclick="showScreen('start')">Home</button>
        <button
          onclick="alert('Avoid walls. Eat Red. Use P to cycle Speed Hacks.')"
        >
          Help
        </button>
      </div>
      <button class="play-now-btn" onclick="startGame()">▶ Play Now</button>
    </div>

    <div class="screen" id="start">
      <h1 class="hero-title">You Grew Up. Snake<br />Didn't. Play It Again.</h1>
      <p class="hero-sub">The classic instinct, refined for the modern eye.</p>
      <button
        class="play-now-btn"
        style="padding: 15px 35px"
        onclick="startGame()"
      >
        ▶ Start Game
      </button>
    </div>

    <div class="screen hidden" id="over">
      <h1 class="hero-title">Game Over</h1>
      <p id="final-score" class="hero-sub"></p>
      <p style="color: #444; font-size: 0.8rem">Press SPACE to restart</p>
    </div>

    <div id="game-container">
      <canvas id="game"></canvas>
    </div>

    <div class="hud" id="hud"></div>

    <div class="pause-overlay hidden" id="pauseOverlay">
      <div class="countdown" id="timer">3</div>
    </div>

    <div id="dev-tag" class="dev-badge hidden">DEV: SLOW-MO</div>

    <script>
      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");

      let snake, dir, food, loop, score, level;
      let baseSpeed = 120;
      let currentSpeed = 120;
      let paused = false;
      let pCycle = 0; // 0: Normal, 1: Slomo, 2: Mid, 3: Normal
      let isCountingDown = false;
      let eatFlash = 0;
      let pr = localStorage.getItem("naga_pr") || 0;

      const GRID_X = 40;
      const GRID_Y = 22;

      function resize() {
        const container = document.getElementById("game-container");
        const cellSize = Math.min(
          container.clientWidth / GRID_X,
          container.clientHeight / GRID_Y,
        );
        canvas.width = cellSize * GRID_X;
        canvas.height = cellSize * GRID_Y;
      }
      window.addEventListener("resize", resize);
      resize();

      function showScreen(id) {
        document
          .querySelectorAll(".screen")
          .forEach((s) => s.classList.add("hidden"));
        if (id !== "none")
          document.getElementById(id).classList.remove("hidden");
      }

      function startGame() {
        showScreen("none");
        snake = [
          { x: 10, y: 10 },
          { x: 9, y: 10 },
          { x: 8, y: 10 },
        ];
        dir = { x: 1, y: 0 };
        food = { x: 25, y: 10 };
        score = 0;
        level = 1;
        baseSpeed = 120;
        currentSpeed = 120;
        pCycle = 0;
        paused = false;
        document.getElementById("dev-tag").classList.add("hidden");
        resetInterval();
      }

      function resetInterval() {
        clearInterval(loop);
        loop = setInterval(tick, currentSpeed);
      }

      function tick() {
        if (paused || isCountingDown) return;
        const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

        if (
          head.x < 0 ||
          head.x >= GRID_X ||
          head.y < 0 ||
          head.y >= GRID_Y ||
          snake.some((s) => s.x === head.x && s.y === head.y)
        )
          return endGame();

        snake.unshift(head);

        if (head.x === food.x && head.y === food.y) {
          score++;
          eatFlash = 10; // Trigger glow

          // Level Up every 5 food
          if (score % 5 === 0) {
            level++;
            baseSpeed = Math.max(40, baseSpeed - 5);
            if (pCycle === 0) currentSpeed = baseSpeed;
            resetInterval();
          }

          food = {
            x: Math.floor(Math.random() * GRID_X),
            y: Math.floor(Math.random() * GRID_Y),
          };
        } else snake.pop();

        draw();
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const cw = canvas.width / GRID_X;
        const ch = canvas.height / GRID_Y;

        // Background Pulse on Eat
        if (eatFlash > 0) {
          ctx.fillStyle = `rgba(255,255,255,${eatFlash / 100})`;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          eatFlash--;
        }

        // Draw Dot Grid
        for (let i = 0; i < GRID_X; i++) {
          for (let j = 0; j < GRID_Y; j++) {
            // Radial fade logic for edges
            const distToEdge = Math.min(i, GRID_X - i, j, GRID_Y - j);
            const edgeAlpha = Math.min(0.04, distToEdge * 0.01);
            ctx.fillStyle = `rgba(255,255,255,${edgeAlpha})`;
            ctx.fillRect(i * cw + 2, j * ch + 2, cw - 4, ch - 4);
          }
        }

        // Food with Glow
        ctx.shadowBlur = 15;
        ctx.shadowColor = "red";
        ctx.fillStyle = "#ff3b3b";
        ctx.fillRect(food.x * cw + 2, food.y * ch + 2, cw - 4, ch - 4);
        ctx.shadowBlur = 0;

        // Snake with Tail Fade
        snake.forEach((s, i) => {
          const opacity = 1 - i / (snake.length + 5);
          ctx.fillStyle = i === 0 ? "#fff" : `rgba(255,255,255,${opacity})`;
          // Head grows slightly when eating
          const padding = i === 0 && eatFlash > 0 ? 0 : 2;
          ctx.fillRect(
            s.x * cw + padding,
            s.y * ch + padding,
            cw - padding * 2,
            ch - padding * 2,
          );
        });

        document.getElementById("hud").innerText =
          `LEVEL ${level}  —  SCORE ${score}  —  BEST ${pr} ${pCycle > 0 ? " (DEV ACTIVE)" : ""}`;
      }

      function handlePCycle() {
        pCycle = (pCycle + 1) % 4;
        const tag = document.getElementById("dev-tag");

        if (pCycle === 0) {
          currentSpeed = baseSpeed;
          tag.classList.add("hidden");
        } else if (pCycle === 1) {
          currentSpeed = 500; // Slomo
          tag.innerText = "DEV: SLOW-MO";
          tag.classList.remove("hidden");
        } else if (pCycle === 2) {
          currentSpeed = 300; // Mid
          tag.innerText = "DEV: MID-MO";
        } else if (pCycle === 3) {
          currentSpeed = 150; // Near Normal
          tag.innerText = "DEV: FAST-MO";
        }
        resetInterval();
      }

      function togglePause() {
        if (paused) {
          isCountingDown = true;
          const timerEl = document.getElementById("timer");
          document.getElementById("pauseOverlay").classList.remove("hidden");
          let count = 3;
          timerEl.innerText = count;
          const interval = setInterval(() => {
            count--;
            if (count > 0) timerEl.innerText = count;
            else {
              clearInterval(interval);
              paused = false;
              isCountingDown = false;
              document.getElementById("pauseOverlay").classList.add("hidden");
            }
          }, 500);
        } else {
          paused = true;
          document.getElementById("pauseOverlay").classList.remove("hidden");
          document.getElementById("timer").innerText = "PAUSED";
        }
      }

      function endGame() {
        clearInterval(loop);
        if (score > pr) {
          pr = score;
          localStorage.setItem("naga_pr", pr);
        }
        document.getElementById("final-score").innerText =
          `Level ${level} · Score ${score} · Record ${pr}`;
        showScreen("over");
      }

      window.addEventListener("keydown", (e) => {
        const k = e.key.toLowerCase();

        if (k === "p") handlePCycle();
        if (k === "escape") togglePause();

        // Restart on Space/Enter when Game Over
        if (
          (e.key === " " || e.key === "Enter") &&
          !document.getElementById("over").classList.contains("hidden")
        ) {
          startGame();
          return;
        }

        if ((k === "arrowup" || k === "w") && dir.y === 0)
          dir = { x: 0, y: -1 };
        if ((k === "arrowdown" || k === "s") && dir.y === 0)
          dir = { x: 0, y: 1 };
        if ((k === "arrowleft" || k === "a") && dir.x === 0)
          dir = { x: -1, y: 0 };
        if ((k === "arrowright" || k === "d") && dir.x === 0)
          dir = { x: 1, y: 0 };
      });

      showScreen("start");
    </script>
  </body>
</html>
